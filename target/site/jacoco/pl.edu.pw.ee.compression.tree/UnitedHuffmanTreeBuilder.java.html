<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pl"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UnitedHuffmanTreeBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Huffman-coding</a> &gt; <a href="index.source.html" class="el_package">pl.edu.pw.ee.compression.tree</a> &gt; <span class="el_source">UnitedHuffmanTreeBuilder.java</span></div><h1>UnitedHuffmanTreeBuilder.java</h1><pre class="source lang-java linenums">package pl.edu.pw.ee.compression.tree;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.HashMap;
import java.util.Map;
import java.util.PriorityQueue;
import pl.edu.pw.ee.HuffmanTree;
import pl.edu.pw.ee.files_manipulation.FileValidator;

public class UnitedHuffmanTreeBuilder {

    private final File fileToRead;

<span class="fc" id="L19">    public UnitedHuffmanTreeBuilder(File fileToRead) {</span>
<span class="fc" id="L20">        new FileValidator(fileToRead).validateFileForReading();</span>
<span class="fc" id="L21">        this.fileToRead = fileToRead;</span>
<span class="fc" id="L22">    }</span>

    private Map&lt;Character, Integer&gt; countOccurencesOfCharacters()
            throws FileNotFoundException, IOException {

<span class="fc" id="L27">        Map&lt;Character, Integer&gt; occurencesOfCharacters = new HashMap&lt;&gt;();</span>
<span class="fc" id="L28">        BufferedReader reader = new BufferedReader(new InputStreamReader(</span>
                new FileInputStream(fileToRead), &quot;UTF-8&quot;));

        int characterInt;
<span class="fc bfc" id="L32" title="All 2 branches covered.">        while ((characterInt = reader.read()) != -1) {</span>
<span class="fc" id="L33">            Character character = (char) characterInt;</span>
<span class="fc" id="L34">            int occurenceOfCharacter</span>
<span class="fc" id="L35">                    = occurencesOfCharacters.getOrDefault(character, 0);</span>
<span class="fc" id="L36">            occurencesOfCharacters.put(character, ++occurenceOfCharacter);</span>
<span class="fc" id="L37">        }</span>

<span class="fc" id="L39">        return occurencesOfCharacters;</span>
    }

    public HuffmanTree build() throws IOException {
<span class="fc" id="L43">        Map&lt;Character, Integer&gt; occurencesOfCharacters</span>
<span class="fc" id="L44">                = countOccurencesOfCharacters();</span>
<span class="fc bfc" id="L45" title="All 2 branches covered.">        if (occurencesOfCharacters.isEmpty()) {</span>
<span class="fc" id="L46">            return null;</span>
        }

<span class="fc" id="L49">        PriorityQueue&lt;HuffmanTree&gt; pq = new PriorityQueue&lt;&gt;();</span>
        for (Map.Entry&lt;Character, Integer&gt; entry
<span class="fc bfc" id="L51" title="All 2 branches covered.">                : occurencesOfCharacters.entrySet()) {</span>
<span class="fc" id="L52">            Character character = entry.getKey();</span>
<span class="fc" id="L53">            int occurence = entry.getValue();</span>
<span class="fc" id="L54">            HuffmanTree tree = new HuffmanTree(occurence, character);</span>
<span class="fc" id="L55">            pq.add(tree);</span>
<span class="fc" id="L56">        }</span>

<span class="fc bfc" id="L58" title="All 2 branches covered.">        if (pq.size() == 1) {</span>
<span class="fc" id="L59">            HuffmanTree oneNode = pq.poll();</span>
<span class="fc" id="L60">            HuffmanTree root = new HuffmanTree(oneNode.getOccurence());</span>
<span class="fc" id="L61">            root.setRightChild(oneNode);</span>
<span class="fc" id="L62">            return root;</span>
        }

<span class="fc bfc" id="L65" title="All 2 branches covered.">        while (pq.size() &gt; 1) {</span>
<span class="fc" id="L66">            HuffmanTree tree1 = pq.poll();</span>
<span class="fc" id="L67">            HuffmanTree tree2 = pq.poll();</span>

<span class="fc" id="L69">            Character character = null;</span>
<span class="fc" id="L70">            int occurence = tree1.getOccurence() + tree2.getOccurence();</span>
<span class="fc" id="L71">            HuffmanTree mergedTree = new HuffmanTree(</span>
                    occurence, character, tree1, tree2);
<span class="fc" id="L73">            pq.add(mergedTree);</span>
<span class="fc" id="L74">        }</span>

<span class="fc" id="L76">        return pq.poll();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>